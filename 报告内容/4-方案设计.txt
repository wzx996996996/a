4 方案设计

4.1 系统总体架构图

本系统采用分层架构设计，从上到下分为表示层、业务逻辑层和数据访问层。系统总体架构如下：

┌─────────────────────────────────────────┐
│           表示层（UI Layer）              │
│  ┌───────────────────────────────────┐  │
│  │  GobangApp（主程序入口）          │  │
│  │  - 初始化JavaFX应用               │  │
│  │  - 创建主窗口和场景                │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │  GobangBoard（游戏界面）          │  │
│  │  - 棋盘绘制（Canvas）             │  │
│  │  - 用户交互处理                    │  │
│  │  - 游戏状态管理                    │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│        业务逻辑层（Business Layer）      │
│  ┌───────────────────────────────────┐  │
│  │  游戏逻辑模块                      │  │
│  │  - 下棋逻辑                        │  │
│  │  - 胜负判断（五连珠检测）          │  │
│  │  - 游戏重置                        │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │  AI代码生成模块                    │  │
│  │  - Prompt构建                      │  │
│  │  - 代码生成触发                    │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│      数据访问层（Data Access Layer）     │
│  ┌───────────────────────────────────┐  │
│  │  DeepSeekAPI（API封装）           │  │
│  │  - HTTP请求构建                    │  │
│  │  - API调用执行                     │  │
│  │  - 响应解析                        │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│        外部服务（External Service）      │
│         DeepSeek API Server            │
└─────────────────────────────────────────┘

系统采用事件驱动模型，用户操作触发事件，事件处理器调用相应的业务逻辑，业务逻辑层通过数据访问层与外部API交互。整个系统遵循单一职责原则，各模块职责清晰，便于维护和扩展。

4.2 关键模块功能划分

系统主要包含三个核心模块：（1）游戏界面模块（GobangBoard）：负责棋盘绘制、用户交互和游戏状态展示。使用JavaFX Canvas实现15×15棋盘的绘制，通过鼠标点击事件处理用户下棋操作，实时更新游戏状态并显示当前回合信息。该模块还包含游戏核心逻辑，如五连珠检测算法，通过检查横、竖、左斜、右斜四个方向判断胜负。（2）AI代码生成模块：集成在GobangBoard中，通过demonstrateAICodeGeneration()方法实现。该模块负责构建Prompt、调用DeepSeek API、处理响应并更新UI状态。Prompt设计针对JavaFX代码生成需求，包含方法签名、功能描述、约束条件等信息。（3）API封装模块（DeepSeekAPI）：封装DeepSeek API的调用细节，包括HTTP请求构建、JSON序列化/反序列化、错误处理等。该模块使用OkHttp发送HTTP请求，使用Gson处理JSON数据，提供简洁的generateCode()接口供上层调用。三个模块通过清晰的接口交互，实现了功能的解耦和复用。

4.3 Prompt 设计与交互流程

Prompt设计采用结构化方式，包含以下要素：（1）功能描述：明确说明需要生成的方法功能，如"计算五子棋棋盘上某个位置周围的空格数量"；（2）方法签名：指定方法名、参数类型和返回值，如"public int countEmptyNeighbors(int[][] board, int row, int col, int boardSize)"；（3）约束条件：明确参数含义和边界条件，如"board为0表示空格，非0表示已有棋子"；（4）方向说明：指定检查方向，如"上下左右四个方向"。交互流程如下：用户点击"使用AI生成代码"按钮 → GobangBoard创建DeepSeekAPI实例并构建Prompt → 在后台线程中调用generateCode()方法 → DeepSeekAPI构建HTTP请求（包含model、messages、temperature等参数） → 发送POST请求到DeepSeek API服务器 → 服务器返回JSON响应 → DeepSeekAPI解析响应提取生成的代码 → 通过Platform.runLater()更新UI显示状态 → 在控制台输出生成的代码。整个过程采用异步处理，避免阻塞UI线程，提升用户体验。通过结构化的Prompt设计，AI能够准确理解需求并生成符合要求的Java代码。

